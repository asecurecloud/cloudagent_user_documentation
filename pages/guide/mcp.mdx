import { Callout } from 'nextra/components'

# MCP Integration

## Objective
Connect your IDE to CloudAgent using the Model Context Protocol (MCP) to build and deploy cloud infrastructure directly from your development environment.

<Callout type="info">
  **What is MCP?** The Model Context Protocol is an open standard that allows AI-powered IDEs like Cursor to connect to external tools and services. CloudAgent's MCP server lets your AI coding assistant deploy infrastructure on your behalf, with built-in guardrails.
</Callout>

## Prerequisites

Before setting up MCP, ensure you have:

- A CloudAgent account with at least one [connected AWS environment](/guide/onboarding)
- [Cursor IDE](https://cursor.com) installed (version 0.43 or later)
- A workload configured with your team's security baselines and governance rules

## Step 1: Get Your MCP Configuration

1. Log in to [CloudAgent](https://cloudagent.io).
2. Navigate to **My Account** â†’ **MCP Extension**.
3. Copy the configuration using **Copy Configuration** or download it with **Download Config**.

The configuration file looks like this:

```json
{
  "mcpServers": {
    "cloudagent": {
      "url": "https://api.cloudagent.io/mcp",
      "enabled": true
    }
  }
}
```

## Step 2: Configure Cursor

1. Open Cursor IDE.
2. Open the Command Palette (`Cmd+Shift+P` on macOS, `Ctrl+Shift+P` on Windows/Linux).
3. Search for **"Cursor Settings: Open MCP Config"** and select it.
4. Paste your CloudAgent MCP configuration.
5. Save the file and restart Cursor.

<Callout type="info">
  **Other Tools**: CloudAgent MCP also works with ChatGPT, Claude, and other MCP-compatible tools. Check the Setup Instructions tabs on the MCP Extension page for tool-specific guidance.
</Callout>

## Step 3: Authenticate with OAuth

When you first connect to the CloudAgent MCP server, you'll be prompted to authenticate:

1. Open a new chat in Cursor (Composer or Chat panel).
2. Type any CloudAgent command, such as: **"List my CloudAgent workloads"**
3. Cursor will prompt you to authenticate with CloudAgent via OAuth.
4. Complete the OAuth flow in your browser.
5. Once authenticated, the AI will respond with your available workloads.

You should see output similar to:

```
Connected to CloudAgent. Available workloads:
- payments-api (prod)
- user-portal (staging)
- data-pipeline (dev)
```

<Callout type="info">
  **Authentication**: MCP authentication uses OAuth. You'll be prompted to authenticate when first connecting to the MCP server. Your session will persist until you sign out.
</Callout>

## Available MCP Capabilities

Once connected, your IDE can perform the following operations through CloudAgent:

### Read Operations (No Approval Required)
- List workloads and their configurations
- View security baselines and governance rules
- Check deployment status and history
- Query AWS resources within workload scope

### Write Operations (Requires Approval)
- Deploy infrastructure blueprints
- Update workload configurations
- Create or modify AWS resources

<Callout type="info">
  **Guardrails Active**: All deployments are validated against your workload's security baselines before execution. If a request violates a security rule, it will be blocked with an explanation.
</Callout>

## Troubleshooting

### "Connection refused" or "Server not found"
- Verify the MCP server URL is `https://api.cloudagent.io/mcp`
- Check that `enabled` is set to `true` in your configuration
- Verify your network allows outbound HTTPS connections

### OAuth authentication not working
- Ensure pop-ups are allowed for the OAuth flow
- Try signing out and re-authenticating
- Clear your browser cookies for cloudagent.io and try again

### "Permission denied" on deployment
- Your workload may have restrictive security baselines
- Contact your security team to review the blocked rule
- Check the CloudAgent dashboard for detailed error logs

### MCP server not appearing in Cursor
- Restart Cursor after saving the MCP configuration
- Ensure the JSON syntax is valid (no trailing commas)
- Check Cursor's developer console for error messages

## Next Steps

- **[Cookbook: Developing in the Corporate Cloud with Guardrails](/cookbooks/cursor-mcp)**: Learn the full workflow for teams using IDE-based cloud development.
- **[Blueprints and Agents](/guide/blueprints)**: Create reusable infrastructure templates for your team.
- **[Managing Workloads](/guide/workloads)**: Configure security baselines and governance rules.
